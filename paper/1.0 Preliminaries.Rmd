# Preliminaries

## Motivation and Introductions

Most common actuarial models used to develop unpaid claim amount estimates require the analysis of claim triangles. The ubiquitous use of triangles is natural as it provides an intuitive construct to understand the movement of a _portfolio_ of claims. As such, both actuaries and non-actuaries (i.e., stakeholders) find the claim triangle understandable and, as a result, acceptable. 

However, a claim triangle is "data-expensive." 

* We require a point-in-time claim listing to construct each diagonal of a claims triangle and we require several of these point-in-time listings evaluated at evenly-spaced intervals. That is, we need to _save_ significant amounts of data.

* Then we _spend_ the data by aggregating the claim-listing by cohorts (such as accident year, report year or policy year).

* We _give away_ all the features of the claim other than its maturity and financial values. Most notably, we give away the open and closed status.

In this paper, we will propose an approach that utilizes granular frequency and severity information to model ultimate values for claims. This paper should not be read as a research paper as that is not the intent. We do not present this paper as a treatise on all possible approaches for modeling individual claims. Rather, our goal is to present a practical approach (i.e., a recipe) accompanied by an `R` package that readers can use to execute the recipe. 

Consistent with that goal, our intent is to provide a fully reproducible "worked example" with this paper. We also present and open source the related code to encourage further development of this model. We also try to keep the "words" in the report to a minimum. This is intentional and it will require you to the read the code which will improve your understanding of the model. 

## Software
We use `R` for this analysis; we assume that other code-based languages would also be able to efficiently execute this code. We think it would be difficult - but not impossible - to execute this model in Excel.

To execute the code, you will require several `R` packages listed below.

```{r packages, echo=TRUE, message=FALSE, warning=FALSE}
# install.packages("easypackages")#allows you to install and load multiple packages at once

library("easypackages")

my_pkgs <- c("markovchain", "msm", 'tidyverse', "ggplot2", "gridExtra")

easypackages::packages(my_pkgs)
easypackages::libraries(my_pkgs)

my_pkgs <- append(x = my_pkgs, values = c('easypackages'))
# need to add these packages to bibliography
```

We also have a packages that accompanies this paper which we load.
```{r echo=TRUE}
# Note to reviewers that we will convert this to a package shortly

source(here::here('functions/square_mats.R'))
source(here::here('functions/plot_mtm.R'))
source(here::here('functions/update_mtm_selection.R'))
source(here::here('functions/mtms.R'))
source(here::here('functions/open_sim.R'))
```


## Data
To allow readers to execute the model that we present, we use synthetic data generated by the [Simulation Engine](https://people.math.ethz.ch/~wmario/simulation.html) developed by Gabrielli and Wüthrich, M.V.[^1] (convert to bibliography for final) for the example presneted herein. This data does not include incurred values. As a result, we present a paid development model. Application to incurred data would be analogous to the application presented in this paper. The primary difference is that incurred information would allow for the consideration of additional variables such as case reserves and paid to incurred ratios.

[^1]: Gabrielli, A., Wüthrich, M.V. (2018). Individual claims history simulation machine. SSRN Manuscript ID 3130560

```{r echo=TRUE, eval=FALSE}
#Not Run

#setwd("path.to/Simulation.Machine.V1")
setwd("D:/rajes/Documents/clrs_2020/e-forum/icr_msm/Simulation.Machine.V1")
# total expected number of claims (over 12 accounting years)
V <- 500 * 12 

# categorical distribution for the allocation of the claims 
# to the 4 lines of business
LoB.dist <- c(1, 0, 0, 0) # All claims from the same line

# growth parameters (per LoB) for the numbers of claims 
#in the 12 accident years
inflation <- c(0.01, 0.01, 0.01, 0.01)   

# setting seed for simulation 
seed1 <- 100                    # use 100 for the train data
#seed1 <- 123456                 # use 123456 for the test data

features <- Feature.Generation(V = V, LoB.dist = LoB.dist, inflation = 
    inflation, seed1 = seed1)

str(features)

###############################################
### Simulate (and store) cash flow patterns ###
###############################################

# blocks for parallel computing
npb <- nrow(features)

# setting seed for simulation
seed1 <- 100                         

# standard deviation parameter for total claim size simulation
std1 <- 0.85                         

# standard deviation parameter for recovery simulation
std2 <- 0.85                         

claims_data <- Simulation.Machine(features = features, npb = npb, 
  seed1 = seed1, std1 = std1, std2 = std2)

#setwd("path.to/project/data") # you may need to set a working directory
saveRDS(object = claims_data, file = './data/icr_data.RDS')
saveRDS(object = claims_data, file = './data/test_data.RDS')
```

## Open Source
The files that we use for this paper are available under the Casualty Actuarial Society's GitHub account.
